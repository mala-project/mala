<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Using ML-DFT models for predictions &mdash; Materials Learning Algorithms (MALA)  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=33f2f6c7" />

  
    <link rel="shortcut icon" href="../_static/mala_favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Advanced options" href="../advanced_usage.html" />
    <link rel="prev" title="Basic hyperparameter optimization" href="hyperparameters.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/mala_horizontal_white.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../basic_usage.html">Getting started with MALA</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="trainingmodel.html">Training an ML-DFT model</a></li>
<li class="toctree-l2"><a class="reference internal" href="more_data.html">Data generation and conversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="hyperparameters.html">Basic hyperparameter optimization</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Using ML-DFT models for predictions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-the-mala-ase-calculator">Using the MALA ASE calculator</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../advanced_usage.html">Advanced options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citing.html">Citing MALA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTE.html">Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/modules.html">API reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Materials Learning Algorithms (MALA)</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../basic_usage.html">Getting started with MALA</a></li>
      <li class="breadcrumb-item active">Using ML-DFT models for predictions</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com//mala-project/mala/blob/develop/docs/source/basic_usage/predictions.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="using-ml-dft-models-for-predictions">
<h1>Using ML-DFT models for predictions<a class="headerlink" href="#using-ml-dft-models-for-predictions" title="Link to this heading"></a></h1>
<p>Having trained and saved a model, this model can now be used for predictions.
This guide follows the examples <code class="docutils literal notranslate"><span class="pre">ex05_run_predictions.py</span></code> and
<code class="docutils literal notranslate"><span class="pre">ex06_ase_calculator.py</span></code>. In the <a class="reference internal" href="../advanced_usage/predictions.html#production"><span class="std std-ref">advanced section</span></a> on
this topic, performance tweaks and extended access to observables are covered.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are working with a 2D-system, and you have explicitly calculated
training data as a 2D-system in Quantum ESPRESSO, make sure to set
<code class="docutils literal notranslate"><span class="pre">parameters.target.assume_two_dimensional</span> <span class="pre">=</span> <span class="pre">True</span></code> before any prediction.</p>
</div>
<p>In order to get direct access to electronic structure via ML, MALA uses
the <code class="docutils literal notranslate"><span class="pre">Predictor</span></code> class. Provided that the trained model was saved with
all the necessary information on the bispectrum descriptors and the LDOS,
no further parameters have to be set here. You have to load the
model and acquire atomic positions (e.g., from a previous molecular dynamics
simulation or other source) via</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ase</span>

<span class="n">parameters</span><span class="p">,</span> <span class="n">network</span><span class="p">,</span> <span class="n">data_handler</span><span class="p">,</span> <span class="n">predictor</span> <span class="o">=</span> <span class="n">mala</span><span class="o">.</span><span class="n">Predictor</span><span class="o">.</span>\
    <span class="n">load_run</span><span class="p">(</span><span class="s2">&quot;be_model&quot;</span><span class="p">)</span>
<span class="n">atoms</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Please note that MALA interfaces are <a class="reference external" href="https://wiki.fysik.dtu.dk/ase/">ASE</a>
compatible. ASE is a powerful library for atomistic modeling in Python,
providing functionalities such as a format for atomic structures and
interfaces to simulation software. Having such an atomic configuration
in the form of a <code class="docutils literal notranslate"><span class="pre">ase.Atoms</span></code> object, a prediction can
be made via</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ldos</span> <span class="o">=</span> <span class="n">predictor</span><span class="o">.</span><span class="n">predict_for_atoms</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>The resulting LDOS can then be processed via the calculator object of
the predictor class to access various observables of interest, such as</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ldos_calculator</span><span class="p">:</span> <span class="n">mala</span><span class="o">.</span><span class="n">LDOS</span> <span class="o">=</span> <span class="n">predictor</span><span class="o">.</span><span class="n">target_calculator</span>
<span class="n">ldos_calculator</span><span class="o">.</span><span class="n">read_from_array</span><span class="p">(</span><span class="n">ldos</span><span class="p">)</span>
<span class="c1"># Total energy of the system</span>
<span class="n">ldos_calculator</span><span class="o">.</span><span class="n">total_energy</span>
<span class="c1"># Electronic density</span>
<span class="n">ldos_calculator</span><span class="o">.</span><span class="n">density</span>
<span class="c1"># Electronic density of states</span>
<span class="n">ldos_calculator</span><span class="o">.</span><span class="n">density_of_states</span>
</pre></div>
</div>
</div></blockquote>
<p>Please note that in order to calculate the total energy, you have to
provide a pseudopotential (specifically the pseudopotential used during
data generation) via <code class="docutils literal notranslate"><span class="pre">parameters.targets.pseudopotential_path</span> <span class="pre">=</span> <span class="pre">...</span></code>.</p>
<section id="using-the-mala-ase-calculator">
<h2>Using the MALA ASE calculator<a class="headerlink" href="#using-the-mala-ase-calculator" title="Link to this heading"></a></h2>
<p>For even easier integration into materials modelling workflows, MALA
provides an ASE calculator interface, called <code class="docutils literal notranslate"><span class="pre">mala.MALA</span></code>
. An ASE calculator is an interface
to an electronic structure simulation code with a specified API;
calculators exist for many simulation codes, such as Quantum ESPRESSO,
GPAW, etc.</p>
<p>The merit of using the MALA ASE calculator is that existing workflows
do not have to be altered - they can be performed faster with
the power of ML. Usage is fairly simple, first, a model is loaded as an
ASE calculator and set a pseudopotential path</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">calculator</span> <span class="o">=</span> <span class="n">mala</span><span class="o">.</span><span class="n">MALA</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="s2">&quot;be_model&quot;</span><span class="p">)</span>
<span class="n">calculator</span><span class="o">.</span><span class="n">mala_parameters</span><span class="o">.</span><span class="n">targets</span><span class="o">.</span><span class="n">pseudopotential_path</span> <span class="o">=</span> <span class="o">...</span>
</pre></div>
</div>
</div></blockquote>
<p>Please note that the <code class="docutils literal notranslate"><span class="pre">mala_parameters</span></code> property is the <code class="docutils literal notranslate"><span class="pre">Parameters</span></code>
object with which the calculator was created/loaded and can be used
just as a <code class="docutils literal notranslate"><span class="pre">Parameters</span></code> object to adjust inference settings
. It is not called <code class="docutils literal notranslate"><span class="pre">parameters</span></code> since that keyword is already
in use by ASE itself.</p>
<p>Afterwards, define/load an ASE atoms object, set the <code class="docutils literal notranslate"><span class="pre">MALA</span></code> object
as a calculator and use the ASE interface to perform the calculation.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">atoms</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="s2">&quot;Be_snapshot1.out&quot;</span><span class="p">))</span>
<span class="n">atoms</span><span class="o">.</span><span class="n">set_calculator</span><span class="p">(</span><span class="n">calculator</span><span class="p">)</span>
<span class="n">atoms</span><span class="o">.</span><span class="n">get_potential_energy</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<p>For more information on ASE calculators, also see the official
<a class="reference external" href="https://wiki.fysik.dtu.dk/ase/ase/calculators/calculators.html">ASE documentation</a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="hyperparameters.html" class="btn btn-neutral float-left" title="Basic hyperparameter optimization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../advanced_usage.html" class="btn btn-neutral float-right" title="Advanced options" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021 National Technology &amp; Engineering Solutions of Sandia, LLC (NTESS). Under the terms of Contract DE-NA0003525 with NTESS, the U.S. Government retains certain rights in this software. Attila Cangi, J. Austin Ellis, Lenz Fiedler, Daniel Kotik, Normand Modine, Sivasankaran Rajamanickam, Steve Schmerler, Aidan Thompson.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>