

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Using postgres on HPC infrastructure (for optuna) &mdash; Materials Learning Algorithms (MALA)  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/mala_favicon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="mala" href="../api/modules.html" />
    <link rel="prev" title="Successfully tested on" href="tested_systems.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Materials Learning Algorithms (MALA)
          

          
          </a>

          
            
            
              <div class="version">
                v0.0.3-alpha-280-g05747b5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../features/background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features/preprocessing.html">Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features/neuralnetworks.html">Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features/postprocessing.html">Postprocessing</a></li>
</ul>
<p class="caption"><span class="caption-text">Installation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">Installation of MALA</a></li>
<li class="toctree-l1"><a class="reference internal" href="INSTALL_LAMMPS.html">Setting up LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="INSTALL_TE_QE.html">Python bindings to Quantum Espresso</a></li>
<li class="toctree-l1"><a class="reference internal" href="tested_systems.html">Successfully tested on</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Using postgres on HPC infrastructure (for optuna)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#hemera5-hzdr">Hemera5 (HZDR)</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/modules.html">mala</a></li>
</ul>
<p class="caption"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTE.html">Contributing to MALA</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Materials Learning Algorithms (MALA)</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Using postgres on HPC infrastructure (for optuna)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com//mala-project/mala/blob/develop/docs/source/install/sql_on_hpc.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-postgres-on-hpc-infrastructure-for-optuna">
<h1>Using postgres on HPC infrastructure (for optuna)<a class="headerlink" href="#using-postgres-on-hpc-infrastructure-for-optuna" title="Permalink to this headline">¶</a></h1>
<div class="section" id="hemera5-hzdr">
<h2>Hemera5 (HZDR)<a class="headerlink" href="#hemera5-hzdr" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p>Install postgres (e.g. in a conda environment)</p></li>
<li><p>Initialize a postgres server configuration somewhere in your home directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> /a/suitable/location/
$ initdb -D YOUR_SERVER_NAME
</pre></div>
</div>
</li>
<li><p>Edit the configuration files of this server:</p>
<blockquote>
<div><ul class="simple">
<li><p>In <code class="file docutils literal notranslate"><span class="pre">postgres_local/postgresql.conf</span></code> add/change the line containing listen_adresses so that it reads:
<code class="docutils literal notranslate"><span class="pre">listen_addresses</span> <span class="pre">=</span> <span class="pre">'*'</span></code></p></li>
<li><p>In <code class="file docutils literal notranslate"><span class="pre">pg_hba.conf</span></code>, under <code class="docutils literal notranslate"><span class="pre">IPv$</span></code> local connections add the line:
<code class="docutils literal notranslate"><span class="pre">host</span>&#160;&#160;&#160; <span class="pre">all</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">all</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">0.0.0.0/0</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">trust</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p>Start the postgres server:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pg_ctl -D postgres_local -l logfile start
</pre></div>
</div>
</li>
<li><p>Create the “username database”</p>
<blockquote>
<div><ul class="simple">
<li><p>This is needed in order to access the psql interface (for maintenance): <code class="docutils literal notranslate"><span class="pre">createdb</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p>Create a database for your hyperparameter optimizations: <code class="docutils literal notranslate"><span class="pre">createdb</span> <span class="pre">YOUR_DATABASE_NAME</span></code></p></li>
<li><p>Host a postgres server via a compute job:</p>
<blockquote>
<div><ul>
<li><p>You can/should also create a database for optuna, so you can create a study from within Python</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /a/suitable/location/
pg_ctl -D A_DESCRIPTIVE_SERVER_NAME -l logfile start
createdb YOUR_SERVER_NAME

<span class="k">while</span> true<span class="p">;</span> <span class="k">do</span>
  pg_ctl -D postgres_local status
  sleep 60m
<span class="k">done</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</li>
<li><p>MALA/Optuna can now connect to this database via</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">parameters</span><span class="o">.</span><span class="n">hyperparameters</span><span class="o">.</span><span class="n">rdb_storage</span> <span class="o">=</span> <span class="s2">&quot;postgresql://YOUR_USER_NAME@YOUR_COMPUTE_NODE/YOUR_DATABASE_NAME&quot;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>[optional] To increase the maximum number of connections to PostgreSQL (default is 100), go to <code class="docutils literal notranslate"><span class="pre">a/suitable/location/postgres_local/postgresql.conf</span></code> and change the value of <code class="docutils literal notranslate"><span class="pre">max_connections</span></code>. In addition, the value of <code class="docutils literal notranslate"><span class="pre">shared_buffers</span></code> is recommended to be set to about 10% of RAM available on a compute node. Note that the actual number of connections exceeds the number of workers, likely because the workers establish new connections every time they communicate with DB and idle connections not dying out by default.</p></li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../api/modules.html" class="btn btn-neutral float-right" title="mala" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="tested_systems.html" class="btn btn-neutral float-left" title="Successfully tested on" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021 National Technology &amp; Engineering Solutions of Sandia, LLC (NTESS). Under the terms of Contract DE-NA0003525 with NTESS, the U.S. Government retains certain rights in this software. Attila Cangi, J. Austin Ellis, Lenz Fiedler, Daniel Kotik, Normand Modine, Sivasankaran Rajamanickam, Steve Schmerler, Aidan Thompson.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>